# Gemini検索エージェント (Self-Correcting Research Agent)

## 概要

これは、単なる検索ツールではありません。Googleの最新AIであるGeminiを搭載し、**自ら思考戦略を立て、自己評価と反復検索を繰り返す**ことで、ユーザーの要求に対して粘り強く、質の高い回答を生成することを目指す高度な検索エージェントです。

このプロジェクトは、AIロジックを担う「専門エージェント」 (`gemini_agent.py`) と、ユーザーとの窓口となる「司令塔」 (`main_app.py`) に役割を完全に分離した、クリーンなアーキテクチャを採用しています。

## 主な特徴

-   **🧠 自律的な戦略プランニング**:
    ユーザーの質問を分析し、「思考言語（英語/日本語）」と「難易度（高/中/低）」をAIが自ら判断。最適なアプローチで調査を開始します。

-   **🔄 自己評価と反復検索**:
    一度の検索で得られた情報が不十分な場合、エージェントは「何が足りないか」を自己評価し、より具体的なクエリで**追加のWeb検索を自動的に実行**します。これにより、情報の網羅性と精度を極限まで高めます。

-   **🏢 関心の分離アーキテクチャ**:
    AIの複雑なロジックはすべて`gemini_agent.py`にカプセル化。司令塔である`main_app.py`は、エージェントに仕事を依頼し、報告書を受け取るだけなので、コードの見通しが良く、メンテナンスや機能拡張が容易です。

-   **🔍 透明性の確保**:
    最終的な回答だけでなく、AIがどのように考え、調査を進めたかの「思考の要約」と、回答の根拠となった「情報源のURL」を明示。AIの判断プロセスを追跡できます。

## 技術スタック

-   Python 3.8以上
-   **Google AI Python SDK (`google-genai`)**
-   Requests (情報源URLの解決用)
-   Python-Dotenv (APIキー管理用)

---

## 🚀 セットアップ手順

### 1. リポジトリをクローン

```bash
git clone <リポジトリのURL>
cd <リポジトリ名>
```

### 2. Python仮想環境の作成と有効化

クリーンな環境で実行するために、仮想環境を作成することを強く推奨します。

```bash
# 仮想環境を作成
python -m venv venv

# 仮想環境を有効化
# Windowsの場合
.\venv\Scripts\activate
# macOS / Linuxの場合
source venv/bin/activate
```

### 3. APIキーの設定

1.  [Google AI Studio](https://aistudio.google.com/app/apikey)にアクセスし、APIキーを取得します。
2.  プロジェクトのルートディレクトリに `.env` という名前のファイルを作成します。
3.  作成した`.env`ファイルに、取得したAPIキーを以下のように記述します。

    **.env**
    ```
    GOOGLE_API_KEY="ここにあなたのAPIキーを貼り付けてください"
    ```

### 4. 依存パッケージのインストール

`requirements.txt`ファイルに必要なライブラリがすべて記載されています。以下のコマンドで一度にインストールします。

```bash
pip install -r requirements.txt
```*(もし`uv`をお使いの場合は `uv pip install -r requirements.txt` でも同様にインストールできます)*


## 実行方法

セットアップが完了したら、ターミナルから`main_app.py`を実行します。引数として、エージェントに尋ねたい質問を文字列で渡してください。

### 実行例

**単純な質問:**
```bash
python main_app.py "日本の現在の首相は誰ですか？"
```

**専門的な調査:**
```bash
python main_app.py "米国株で、配当利回りが4%以上の銘柄を5つ、その利回りデータと共に教えて"
```

**複雑な分析:**
```bash
python main_app.py "Pythonの非同期処理について、async/awaitの基本的な使い方とメリット・デメリットをまとめて"
```

---

## 🏛️ アーキテクチャとコード解説

### `main_app.py` (司令塔)
-   **役割**: ユーザーからの指令（コマンドライン引数）を受け取り、エージェントに渡し、返ってきた報告書（結果）を見やすく表示することに特化しています。
-   AIの内部ロジックについては一切関知しません。
-   受け取った情報源のURL（リダイレクトされている場合がある）を解決し、最終的なURLを表示する機能も持ちます。

### `gemini_agent.py` (専門エージェント)
-   **役割**: このアプリケーションの頭脳です。指令を達成するための全てのAIロジックを内包します。
-   **`_decide_strategy(query)`**:【内部関数】第一エージェント。指令の性質を分析し、最適な「思考言語」と「難易度」からなる戦略を立案します。
-   **`ask_agent(query)`**:【公開関数】第二エージェントであり、唯一の公開窓口。立案された戦略に基づき、システムプロンプト（自己評価と反復検索のルール）を設定し、Google検索ツールを使って調査を実行。最終的な回答、思考の要約、情報源を生成して司令塔に報告します。

## ライセンス

このプロジェクトは [MITライセンス](LICENSE) の下で公開されています。